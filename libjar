#!/usr/bin/env python
import sys, os, zipfile, shutil
import argparse
from distutils import dir_util, file_util

sys.stdout = os.fdopen(sys.stdout.fileno(), 'w', 0)
parser = argparse.ArgumentParser(description='Combine files into single jar')
parser.add_argument('files',
		nargs='+', help='input files')
parser.add_argument('-o', '--out',
		default='out', help='output jar name (default: out)')
parser.add_argument('-m', '--main',
		help='Java Class containing main')

args = parser.parse_args()

TEMP = '.tmp_libjar'
try:
	shutil.rmtree(TEMP)
	os.remove(TEMP)
except OSError: pass
os.mkdir(TEMP)

for arg in args.files:
	if(zipfile.is_zipfile(arg)):
		injar = zipfile.ZipFile(arg, 'r')
		print 'extracting "%s" ...' % arg,
		injar.extractall(TEMP)
		injar.close()
		print 'done'
	else:
		print 'copying "%s" ...' % arg,
		dest = os.path.join(TEMP, os.path.basename(os.path.normpath(arg)))
		if(os.path.isdir(arg)):
			dir_util.copy_tree(arg, dest)
		else:
			file_util.copy_file(arg, TEMP)
		print 'done'

"main...(\[Ljava/lang/String;)V"

print 'zipping as "%s.jar" ...' % args.out,
shutil.make_archive(".tmp_out", "zip", TEMP)
os.rename(".tmp_out.zip", "%s.jar" % args.out)
print 'done'
print 'cleaning up ...',
shutil.rmtree(TEMP)
print 'done'
